FOR_BOX(function(n){"use strict";n.MODEL=CLASS({init:function(t,i,e){var o;i.getBoxName=o=function(){return n.boxName}}})});FOR_BOX(function(e){"use strict";OVERRIDE(e.MODEL,function(o){e.MODEL=CLASS(function(t){var i,n={},r=0;return t.getOnNewInfos=i=function(){return n},{preset:function(){return o},init:function(o,t,i){var d,a,c,v,u,s,E,f,m,l,A,O,C,N,M,R,T,g,S,D,h,x,P,H,U,I,L,_,p=i.roomServerName,b=i.name,k=i.initData,V=i.methodConfig,B=(i.isNotUsingObjectId,e.ROOM({roomServerName:p,name:b}));void 0!==V&&(d=V.create,a=V.get,c=V.update,v=V.remove,u=V.find,s=V.count,E=V.checkIsExists,void 0!==d&&(f=d.valid),void 0!==c&&(m=c.valid)),t.getName=l=function(){return b},t.getInitData=A=function(){return k},t.getCreateValid=O=function(){return f},t.getUpdateValid=C=function(){return m},t.getRoom=N=function(){return B},d!==!1&&(t.create=M=function(o,t){var i,n,r,d,a;void 0!==t&&(CHECK_IS_DATA(t)!==!0?i=t:(i=t.success,n=t.notValid,r=t.notAuthed,d=t.error)),void 0!==k&&EACH(k,function(e,t){o[t]=e}),void 0!==f&&(a=f.check(o)),void 0!==a&&a.checkHasError()===!0?void 0!==n?n(a.getErrors()):console.log("[UPPERCASE-MODEL] `"+e.boxName+"."+b+"Model.create` NOT VALID!: ",a.getErrors()):B.send({methodName:"create",data:o},function(o){var t,a,c,v;void 0!==o?(t=o.errorMsg,a=o.validErrors,c=o.isNotAuthed,v=o.savedData,void 0!==t?void 0!==d?d(t):console.log("[UPPERCASE-MODEL] `"+e.boxName+"."+b+"Model.create` ERROR: "+t):void 0!==a?void 0!==n?n(a):console.log("[UPPERCASE-MODEL] `"+e.boxName+"."+b+"Model.create` NOT VALID!: ",a):c===!0?void 0!==r?r():console.log("[UPPERCASE-MODEL] `"+e.boxName+"."+b+"Model.create` NOT AUTHED!"):void 0!==i&&i(v)):void 0!==i&&i()})}),a!==!1&&(t.get=R=function(o,t){var i,n,r,d;void 0===t&&(t=o,o={}),CHECK_IS_DATA(t)!==!0?i=t:(i=t.success,n=t.notExists,r=t.notAuthed,d=t.error),B.send({methodName:"get",data:o},function(t){var a,c,v;void 0!==t&&(a=t.errorMsg,c=t.isNotAuthed,v=t.savedData),void 0!==a?void 0!==d?d(a):console.log("[UPPERCASE-MODEL] `"+e.boxName+"."+b+"Model.get` ERROR: "+a):c===!0?void 0!==r?r():console.log("[UPPERCASE-MODEL] `"+e.boxName+"."+b+"Model.get` NOT AUTHED!"):void 0===v?void 0!==n?n():console.log("[UPPERCASE-MODEL] `"+e.boxName+"."+b+"Model.get` NOT EXISTS!",o):void 0!==i&&i(v)})},t.getWatching=T=function(o,i){var n,r,d,a,c,v;return void 0===i&&(i=o,o={}),CHECK_IS_DATA(i)!==!0?n=i:(n=i.success,r=i.notExists,d=i.notAuthed,a=i.error),t.get(o,{success:function(o){var t;c!==!0&&void 0!==n&&(v=e.ROOM({roomServerName:p,name:b+"/"+o.id}),n(o,function(e){v.on("update",e)},function(e){v.on("remove",function(o){e(o),t()})},t=function(){void 0!==v&&(v.exit(),v=void 0)}))},notExists:r,notAuthed:d,error:a}),OBJECT({init:function(e,o){var t;o.exit=t=function(){void 0!==v&&v.exit(),c=!0}}})}),c!==!1&&(t.update=g=function(o,t){var i,n,r,d,a,c,v,u,s,E,f=o.id,l=o.$inc,A=o.$push,O=o.$pull;void 0!==t&&(CHECK_IS_DATA(t)!==!0?i=t:(i=t.success,n=t.notValid,r=t.notExists,d=t.notAuthed,a=t.error)),void 0!==m&&(c=m.checkForUpdate(o),void 0!==l&&(v=m.checkForUpdate(l)),void 0!==A&&(u=m.checkForUpdate(RUN(function(){var e={};return EACH(A,function(o,t){e[t]=[o]}),e}))),void 0!==O&&(s=m.checkForUpdate(RUN(function(){var e={};return EACH(O,function(o,t){e[t]=[o]}),e})))),o.id=f,o.$inc=l,o.$push=A,o.$pull=O,void 0!==m&&(c.checkHasError()===!0||void 0!==v&&v.checkHasError()===!0||void 0!==u&&u.checkHasError()===!0||void 0!==s&&s.checkHasError()===!0)?(E=COMBINE([c.getErrors(),void 0===v?{}:v.getErrors(),void 0===u?{}:u.getErrors(),void 0===s?{}:s.getErrors()]),void 0!==n?n(E):console.log("[UPPERCASE-MODEL] `"+e.boxName+"."+b+"Model.update` NOT VALID!: ",E)):B.send({methodName:"update",data:o},function(t){var c,v,u,s,E;void 0!==t&&(c=t.errorMsg,v=t.validErrors,u=t.isNotAuthed,s=t.savedData,E=t.originData),void 0!==c?void 0!==a?a(c):console.log("[UPPERCASE-MODEL] `"+e.boxName+"."+b+"Model.update` ERROR: "+c):void 0!==v?void 0!==n?n(v):console.log("[UPPERCASE-MODEL] `"+e.boxName+"."+b+"Model.update` NOT VALID!: ",v):u===!0?void 0!==d?d():console.log("[UPPERCASE-MODEL] `"+e.boxName+"."+b+"Model.update` NOT AUTHED!"):void 0===s?void 0!==r?r():console.log("[UPPERCASE-MODEL] `"+e.boxName+"."+b+"Model.update` NOT EXISTS!",o.id):void 0!==i&&i(s,E)})}),v!==!1&&(t.remove=S=function(o,t){var i,n,r,d;void 0!==t&&(CHECK_IS_DATA(t)!==!0?i=t:(i=t.success,n=t.notExists,r=t.notAuthed,d=t.error)),B.send({methodName:"remove",data:o},function(t){var a,c,v;void 0!==t&&(a=t.errorMsg,c=t.isNotAuthed,v=t.originData),void 0!==a?void 0!==d?d(a):console.log("[UPPERCASE-MODEL] `"+e.boxName+"."+b+"Model.remove` ERROR: "+a):c===!0?void 0!==r?r():console.log("[UPPERCASE-MODEL] `"+e.boxName+"."+b+"Model.remove` NOT AUTHED!"):void 0===v?void 0!==n?n():console.log("[UPPERCASE-MODEL] `"+e.boxName+"."+b+"Model.remove` NOT EXISTS!",o):void 0!==i&&i(v)})}),u!==!1&&(t.find=D=function(o,t){var i,n,r;void 0===t&&(t=o,o=void 0),CHECK_IS_DATA(t)!==!0?i=t:(i=t.success,n=t.notAuthed,r=t.error),B.send({methodName:"find",data:o},function(o){var t=o.errorMsg,d=o.isNotAuthed,a=o.savedDataSet;void 0!==t?void 0!==r?r(t):console.log("[UPPERCASE-MODEL] `"+e.boxName+"."+b+"Model.find` ERROR: "+t):d===!0?void 0!==n?n():console.log("[UPPERCASE-MODEL] `"+e.boxName+"."+b+"Model.find` NOT AUTHED!"):void 0!==i&&i(a)})},t.findWatching=h=function(o,i){var n,r,d,a,c={};return void 0===i&&(i=o,o=void 0),CHECK_IS_DATA(i)!==!0?n=i:(n=i.success,r=i.notAuthed,d=i.error),t.find(o,{success:function(o){var t;a!==!0&&void 0!==n&&(EACH(o,function(o,t){var i=o.id;c[i]=e.ROOM({roomServerName:p,name:b+"/"+i})}),n(o,function(e,o){c[e].on("update",o)},function(e,o){c[e].on("remove",function(i){o(i),t(e)})},t=function(e){void 0!==c[e]&&(c[e].exit(),delete c[e])}))},notAuthed:r,error:d}),OBJECT({init:function(e,o){var t;o.exit=t=function(){EACH(c,function(e){e.exit()}),a=!0}}})}),s!==!1&&(t.count=x=function(o,t){var i,n,r;void 0===t&&(t=o,o=void 0),CHECK_IS_DATA(t)!==!0?i=t:(i=t.success,n=t.notAuthed,r=t.error),B.send({methodName:"count",data:o},function(o){var t=o.errorMsg,d=o.isNotAuthed,a=o.count;void 0!==t?void 0!==r?r(t):console.log("[UPPERCASE-MODEL] `"+e.boxName+"."+b+"Model.count` ERROR: "+t):d===!0?void 0!==n?n():console.log("[UPPERCASE-MODEL] `"+e.boxName+"."+b+"Model.count` NOT AUTHED!"):void 0!==i&&i(a)})}),E!==!1&&(t.checkIsExists=P=function(o,t){var i,n,r;void 0===t&&(t=o,o=void 0),CHECK_IS_DATA(t)!==!0?i=t:(i=t.success,n=t.notAuthed,r=t.error),B.send({methodName:"checkIsExists",data:o},function(o){var t=o.errorMsg,d=o.isNotAuthed,a=o.isExists;void 0!==t?void 0!==r?r(t):console.log("[UPPERCASE-MODEL] `"+e.boxName+"."+b+"Model.checkIsExists` ERROR: "+t):d===!0?void 0!==n?n():console.log("[UPPERCASE-MODEL] `"+e.boxName+"."+b+"Model.checkIsExists` NOT AUTHED!"):void 0!==i&&i(a)})}),t.onNew=H=function(o,t){var i,d=r;if(r+=1,void 0===t)t=o,o=void 0,(i=e.ROOM({roomServerName:p,name:b+"/create"})).on("create",function(e){n[d].lastCreateTime=e.createTime,t(e)});else if(void 0===o)(i=e.ROOM({roomServerName:p,name:b+"/create"})).on("create",function(e){n[d].lastCreateTime=e.createTime,t(e)});else if(EACH(o,function(r,a){return void 0!==r?((i=e.ROOM({roomServerName:p,name:b+"/"+a+"/"+r+"/create"})).on("create",function(e){EACH(o,function(o,t){if(void 0!==o)if(o===TO_DELETE){if(void 0!==e[t])return!1}else if(e[t]!==o)return!1})===!0&&(n[d].lastCreateTime=e.createTime,t(e))}),!1):void 0}),void 0===i)return void H(void 0,t);return n[d]={findMissingDataSet:function(){void 0!==n[d].lastCreateTime&&void 0!==D&&D({filter:void 0!==o?COMBINE([o,{createTime:{$gt:n[d].lastCreateTime}}]):{createTime:{$gt:n[d].lastCreateTime}}},REVERSE_EACH(t))}},OBJECT({init:function(e,o){var t;o.exit=t=function(){delete n[d],void 0!==i&&i.exit()}}})},t.onNewWatching=U=function(o,t){var i,d=r,a=[],c=function(o){var i,n,r=o.id;a.push(i=e.ROOM({roomServerName:p,name:b+"/"+r})),t(o,function(e){i.on("update",e)},function(e){i.on("remove",function(o){e(o),n()})},n=function(){i.exit(),REMOVE({array:a,value:i})})};if(r+=1,void 0===t)t=o,o=void 0,(i=e.ROOM({roomServerName:p,name:b+"/create"})).on("create",function(e){n[d].lastCreateTime=e.createTime,c(e)});else if(void 0===o)(i=e.ROOM({roomServerName:p,name:b+"/create"})).on("create",function(e){n[d].lastCreateTime=e.createTime,c(e)});else if(EACH(o,function(t,r){return void 0!==t?((i=e.ROOM({roomServerName:p,name:b+"/"+r+"/"+t+"/create"})).on("create",function(e){EACH(o,function(o,t){if(void 0!==o)if(o===TO_DELETE){if(void 0!==e[t])return!1}else if(e[t]!==o)return!1})===!0&&(n[d].lastCreateTime=e.createTime,c(e))}),!1):void 0}),void 0===i)return void U(void 0,t);return n[d]={findMissingDataSet:function(){void 0!==n[d].lastCreateTime&&void 0!==D&&D({filter:void 0!==o?COMBINE([o,{createTime:{$gt:n[d].lastCreateTime}}]):{createTime:{$gt:n[d].lastCreateTime}}},REVERSE_EACH(c))}},OBJECT({init:function(e,o){var t;o.exit=t=function(){delete n[d],void 0!==i&&i.exit(),EACH(a,function(e){e.exit()})}}})},u!==!1&&(t.onNewAndFind=I=function(e,o){var t,i,n,r,d,a,c,v,u,s,E;return void 0===o&&(o=e,e=void 0),void 0!==e&&(t=e.properties,i=e.filter,n=e.sort,r=e.start,d=e.count,a=e.isNotOnNew),CHECK_IS_DATA(o)!==!0?v=o:(v=o.handler,u=o.success,s=o.notAuthed,E=o.error),a!==!0&&(c=H(t,function(e){v(e,!0)})),D({filter:COMBINE([t,i]),sort:n,start:r,count:d},{success:function(e){void 0!==u&&u(e),REVERSE_EACH(e,function(e){v(e,!1)})},notAuthed:s,error:E}),OBJECT({init:function(e,o){var t;o.exit=t=function(){void 0!==c&&c.exit()}}})},t.onNewAndFindWatching=L=function(e,o){var t,i,n,r,d,a,c,v,u,s,E,f;return void 0===o&&(o=e,e=void 0),void 0!==e&&(t=e.properties,i=e.filter,n=e.sort,r=e.start,d=e.count,a=e.isNotOnNew),CHECK_IS_DATA(o)!==!0?u=o:(u=o.handler,s=o.success,E=o.notAuthed,f=o.error),a!==!0&&(c=U(t,function(e,o,t,i){u(e,o,t,i,!0)})),v=h({filter:COMBINE([t,i]),sort:n,start:r,count:d},{success:function(e,o,t,i){void 0!==s&&s(e,o,t,i),REVERSE_EACH(e,function(e){u(e,function(t){o(e.id,t)},function(o){t(e.id,o)},function(){i(e.id)},!1)})},notAuthed:E,error:f}),OBJECT({init:function(e,o){var t;o.exit=t=function(){void 0!==c&&c.exit(),v.exit()}}})}),t.onRemove=_=function(o,t){var i;return void 0===t?(t=o,(i=e.ROOM({roomServerName:p,name:b+"/remove"})).on("remove",t)):EACH(o,function(n,r){return void 0!==n?((i=e.ROOM({roomServerName:p,name:b+"/"+r+"/"+n+"/remove"})).on("remove",function(e){EACH(o,function(o,t){if(void 0!==o)if(o===TO_DELETE){if(void 0!==e[t])return!1}else if(e[t]!==o)return!1})===!0&&t(e)}),!1):void 0}),OBJECT({init:function(e,o){var t;o.exit=t=function(){void 0!==i&&i.exit()}}})}}}})})});