FOR_BOX(function(n){"use strict";n.MODEL=CLASS({init:function(t,i,e){var o;i.getBoxName=o=function(){return n.boxName}}})});FOR_BOX(function(e){"use strict";OVERRIDE(e.MODEL,function(o){e.MODEL=CLASS(function(t){var i,n={},r=0;return t.getOnNewInfos=i=function(){return n},{preset:function(){return o},init:function(o,t,i){var a,d,c,v,u,s,E,f,m,A,O,C,l,N,R,T,g,S,D,h,x,M,P,H,U,I,L,_,p=i.roomServerName,b=i.name,k=i.initData,V=i.methodConfig,B=(i.isNotUsingObjectId,e.ROOM({roomServerName:p,name:b}));void 0!==V&&(a=V.create,d=V.get,c=V.update,v=V.remove,u=V.find,s=V.count,E=V.checkIsExists,void 0!==a&&(f=a.valid),void 0!==c&&(m=c.valid)),t.getName=A=function(){return b},t.getInitData=O=function(){return k},t.getCreateValid=C=function(){return f},t.getUpdateValid=l=function(){return m},t.getRoom=N=function(){return B},a!==!1&&(t.create=R=function(o,t){var i,n,r,a,d;void 0!==t&&(CHECK_IS_DATA(t)!==!0?i=t:(i=t.success,n=t.notValid,r=t.notAuthed,a=t.error)),void 0!==k&&EACH(k,function(e,t){o[t]=e}),void 0!==f&&(d=f.check(o)),void 0!==d&&d.checkHasError()===!0?void 0!==n?n(d.getErrors()):console.log("[UPPERCASE-MODEL] `"+e.boxName+"."+b+"/create` NOT VALID!: ",d.getErrors()):B.send({methodName:"create",data:o},function(o){var t,d,c,v;void 0!==o?(t=o.errorMsg,d=o.validErrors,c=o.isNotAuthed,v=o.savedData,void 0!==t?void 0!==a?a(t):console.log("[UPPERCASE-MODEL] `"+e.boxName+"."+b+"/create` ERROR: "+t):void 0!==d?void 0!==n?n(d):console.log("[UPPERCASE-MODEL] `"+e.boxName+"."+b+"/create` NOT VALID!: ",d):c===!0?void 0!==r?r():console.log("[UPPERCASE-MODEL] `"+e.boxName+"."+b+"/create` NOT AUTHED!"):void 0!==i&&i(v)):void 0!==i&&i()})}),d!==!1&&(t.get=T=function(o,t){var i,n,r,a;void 0===t&&(t=o,o={}),CHECK_IS_DATA(t)!==!0?i=t:(i=t.success,n=t.notExists,r=t.notAuthed,a=t.error),B.send({methodName:"get",data:o},function(o){var t,d,c;void 0!==o&&(t=o.errorMsg,d=o.isNotAuthed,c=o.savedData),void 0!==t?void 0!==a?a(t):console.log("[UPPERCASE-MODEL] `"+e.boxName+"."+b+"/get` ERROR: "+t):d===!0?void 0!==r?r():console.log("[UPPERCASE-MODEL] `"+e.boxName+"."+b+"/get` NOT AUTHED!"):void 0===c?void 0!==n?n():console.log("[UPPERCASE-MODEL] `"+e.boxName+"."+b+"/get` NOT EXISTS!"):void 0!==i&&i(c)})},t.getWatching=g=function(o,i){var n,r,a,d,c,v;return void 0===i&&(i=o,o={}),CHECK_IS_DATA(i)!==!0?n=i:(n=i.success,r=i.notExists,a=i.notAuthed,d=i.error),t.get(o,{success:function(o){var t;c!==!0&&void 0!==n&&(v=e.ROOM({roomServerName:p,name:b+"/"+o.id}),n(o,function(e){v.on("update",e)},function(e){v.on("remove",function(o){e(o),t()})},t=function(){void 0!==v&&(v.exit(),v=void 0)}))},notExists:r,notAuthed:a,error:d}),OBJECT({init:function(e,o){var t;o.exit=t=function(){void 0!==v&&v.exit(),c=!0}}})}),c!==!1&&(t.update=S=function(o,t){var i,n,r,a,d,c,v,u,s,E,f=o.id,A=o.$inc,O=o.$push,C=o.$pull;void 0!==t&&(CHECK_IS_DATA(t)!==!0?i=t:(i=t.success,n=t.notValid,r=t.notExists,a=t.notAuthed,d=t.error)),void 0!==m&&(c=m.checkForUpdate(o),void 0!==A&&(v=m.checkForUpdate(A)),void 0!==O&&(u=m.checkForUpdate(RUN(function(){var e={};return EACH(O,function(o,t){e[t]=[o]}),e}))),void 0!==C&&(s=m.checkForUpdate(RUN(function(){var e={};return EACH(C,function(o,t){e[t]=[o]}),e})))),o.id=f,o.$inc=A,o.$push=O,o.$pull=C,void 0!==m&&(c.checkHasError()===!0||void 0!==v&&v.checkHasError()===!0||void 0!==u&&u.checkHasError()===!0||void 0!==s&&s.checkHasError()===!0)?(E=COMBINE([c.getErrors(),void 0===v?{}:v.getErrors(),void 0===u?{}:u.getErrors(),void 0===s?{}:s.getErrors()]),void 0!==n?n(E):console.log("[UPPERCASE-MODEL] `"+e.boxName+"."+b+"/update` NOT VALID!: ",E)):B.send({methodName:"update",data:o},function(o){var t,c,v,u,s;void 0!==o&&(t=o.errorMsg,c=o.validErrors,v=o.isNotAuthed,u=o.savedData,s=o.originData),void 0!==t?void 0!==d?d(t):console.log("[UPPERCASE-MODEL] `"+e.boxName+"."+b+"/update` ERROR: "+t):void 0!==c?void 0!==n?n(c):console.log("[UPPERCASE-MODEL] `"+e.boxName+"."+b+"/update` NOT VALID!: ",c):v===!0?void 0!==a?a():console.log("[UPPERCASE-MODEL] `"+e.boxName+"."+b+"/update` NOT AUTHED!"):void 0===u?void 0!==r?r():console.log("[UPPERCASE-MODEL] `"+e.boxName+"."+b+"/update` NOT EXISTS!"):void 0!==i&&i(u,s)})}),v!==!1&&(t.remove=D=function(o,t){var i,n,r,a;void 0!==t&&(CHECK_IS_DATA(t)!==!0?i=t:(i=t.success,n=t.notExists,r=t.notAuthed,a=t.error)),B.send({methodName:"remove",data:o},function(o){var t,d,c;void 0!==o&&(t=o.errorMsg,d=o.isNotAuthed,c=o.originData),void 0!==t?void 0!==a?a(t):console.log("[UPPERCASE-MODEL] `"+e.boxName+"."+b+"/remove` ERROR: "+t):d===!0?void 0!==r?r():console.log("[UPPERCASE-MODEL] `"+e.boxName+"."+b+"/remove` NOT AUTHED!"):void 0===c?void 0!==n?n():console.log("[UPPERCASE-MODEL] `"+e.boxName+"."+b+"/remove` NOT EXISTS!"):void 0!==i&&i(c)})}),u!==!1&&(t.find=h=function(o,t){var i,n,r;void 0===t&&(t=o,o=void 0),CHECK_IS_DATA(t)!==!0?i=t:(i=t.success,n=t.notAuthed,r=t.error),B.send({methodName:"find",data:o},function(o){var t=o.errorMsg,a=o.isNotAuthed,d=o.savedDataSet;void 0!==t?void 0!==r?r(t):console.log("[UPPERCASE-MODEL] `"+e.boxName+"."+b+"/find` ERROR: "+t):a===!0?void 0!==n?n():console.log("[UPPERCASE-MODEL] `"+e.boxName+"."+b+"/find` NOT AUTHED!"):void 0!==i&&i(d)})},t.findWatching=x=function(o,i){var n,r,a,d,c={};return void 0===i&&(i=o,o=void 0),CHECK_IS_DATA(i)!==!0?n=i:(n=i.success,r=i.notAuthed,a=i.error),t.find(o,{success:function(o){var t;d!==!0&&void 0!==n&&(EACH(o,function(o,t){var i=o.id;c[i]=e.ROOM({roomServerName:p,name:b+"/"+i})}),n(o,function(e,o){c[e].on("update",o)},function(e,o){c[e].on("remove",function(i){o(i),t(e)})},t=function(e){void 0!==c[e]&&(c[e].exit(),delete c[e])}))},notAuthed:r,error:a}),OBJECT({init:function(e,o){var t;o.exit=t=function(){EACH(c,function(e){e.exit()}),d=!0}}})}),s!==!1&&(t.count=M=function(o,t){var i,n,r;void 0===t&&(t=o,o=void 0),CHECK_IS_DATA(t)!==!0?i=t:(i=t.success,n=t.notAuthed,r=t.error),B.send({methodName:"count",data:o},function(o){var t=o.errorMsg,a=o.isNotAuthed,d=o.count;void 0!==t?void 0!==r?r(t):console.log("[UPPERCASE-MODEL] `"+e.boxName+"."+b+"/count` ERROR: "+t):a===!0?void 0!==n?n():console.log("[UPPERCASE-MODEL] `"+e.boxName+"."+b+"/count` NOT AUTHED!"):void 0!==i&&i(d)})}),E!==!1&&(t.checkIsExists=P=function(o,t){var i,n,r;void 0===t&&(t=o,o=void 0),CHECK_IS_DATA(t)!==!0?i=t:(i=t.success,n=t.notAuthed,r=t.error),B.send({methodName:"checkIsExists",data:o},function(o){var t=o.errorMsg,a=o.isNotAuthed,d=o.isExists;void 0!==t?void 0!==r?r(t):console.log("[UPPERCASE-MODEL] `"+e.boxName+"."+b+"/checkIsExists` ERROR: "+t):a===!0?void 0!==n?n():console.log("[UPPERCASE-MODEL] `"+e.boxName+"."+b+"/checkIsExists` NOT AUTHED!"):void 0!==i&&i(d)})}),t.onNew=H=function(o,t){var i,a=r;if(r+=1,void 0===t)t=o,o=void 0,(i=e.ROOM({roomServerName:p,name:b+"/create"})).on("create",function(e){n[a].lastCreateTime=e.createTime,t(e)});else if(void 0===o)(i=e.ROOM({roomServerName:p,name:b+"/create"})).on("create",function(e){n[a].lastCreateTime=e.createTime,t(e)});else if(EACH(o,function(r,d){return void 0!==r?((i=e.ROOM({roomServerName:p,name:b+"/"+d+"/"+r+"/create"})).on("create",function(e){EACH(o,function(o,t){if(void 0!==o)if(o===TO_DELETE){if(void 0!==e[t])return!1}else if(e[t]!==o)return!1})===!0&&(n[a].lastCreateTime=e.createTime,t(e))}),!1):void 0}),void 0===i)return void H(void 0,t);return n[a]={findMissingDataSet:function(){void 0!==n[a].lastCreateTime&&void 0!==h&&h({filter:void 0!==o?COMBINE([o,{createTime:{$gt:n[a].lastCreateTime}}]):{createTime:{$gt:n[a].lastCreateTime}}},REVERSE_EACH(t))}},OBJECT({init:function(e,o){var t;o.exit=t=function(){delete n[a],void 0!==i&&i.exit()}}})},t.onNewWatching=U=function(o,t){var i,a=r,d=[],c=function(o){var i,n,r=o.id;d.push(i=e.ROOM({roomServerName:p,name:b+"/"+r})),t(o,function(e){i.on("update",e)},function(e){i.on("remove",function(o){e(o),n()})},n=function(){i.exit(),REMOVE({array:d,value:i})})};if(r+=1,void 0===t)t=o,o=void 0,(i=e.ROOM({roomServerName:p,name:b+"/create"})).on("create",function(e){n[a].lastCreateTime=e.createTime,c(e)});else if(void 0===o)(i=e.ROOM({roomServerName:p,name:b+"/create"})).on("create",function(e){n[a].lastCreateTime=e.createTime,c(e)});else if(EACH(o,function(t,r){return void 0!==t?((i=e.ROOM({roomServerName:p,name:b+"/"+r+"/"+t+"/create"})).on("create",function(e){EACH(o,function(o,t){if(void 0!==o)if(o===TO_DELETE){if(void 0!==e[t])return!1}else if(e[t]!==o)return!1})===!0&&(n[a].lastCreateTime=e.createTime,c(e))}),!1):void 0}),void 0===i)return void U(void 0,t);return n[a]={findMissingDataSet:function(){void 0!==n[a].lastCreateTime&&void 0!==h&&h({filter:void 0!==o?COMBINE([o,{createTime:{$gt:n[a].lastCreateTime}}]):{createTime:{$gt:n[a].lastCreateTime}}},REVERSE_EACH(c))}},OBJECT({init:function(e,o){var t;o.exit=t=function(){delete n[a],void 0!==i&&i.exit(),EACH(d,function(e){e.exit()})}}})},u!==!1&&(t.onNewAndFind=I=function(e,o){var t,i,n,r,a,d,c,v,u,s,E;return void 0===o&&(o=e,e=void 0),void 0!==e&&(t=e.properties,i=e.filter,n=e.sort,r=e.start,a=e.count,d=e.isNotOnNew),CHECK_IS_DATA(o)!==!0?v=o:(v=o.handler,u=o.success,s=o.notAuthed,E=o.error),d!==!0&&(c=H(t,function(e){v(e,!0)})),h({filter:COMBINE([t,i]),sort:n,start:r,count:a},{success:function(e){void 0!==u&&u(e),REVERSE_EACH(e,function(e){v(e,!1)})},notAuthed:s,error:E}),OBJECT({init:function(e,o){var t;o.exit=t=function(){void 0!==c&&c.exit()}}})},t.onNewAndFindWatching=L=function(e,o){var t,i,n,r,a,d,c,v,u,s,E,f;return void 0===o&&(o=e,e=void 0),void 0!==e&&(t=e.properties,i=e.filter,n=e.sort,r=e.start,a=e.count,d=e.isNotOnNew),CHECK_IS_DATA(o)!==!0?u=o:(u=o.handler,s=o.success,E=o.notAuthed,f=o.error),d!==!0&&(c=U(t,function(e,o,t,i){u(e,o,t,i,!0)})),v=x({filter:COMBINE([t,i]),sort:n,start:r,count:a},{success:function(e,o,t,i){void 0!==s&&s(e,o,t,i),REVERSE_EACH(e,function(e){u(e,function(t){o(e.id,t)},function(o){t(e.id,o)},function(){i(e.id)},!1)})},notAuthed:E,error:f}),OBJECT({init:function(e,o){var t;o.exit=t=function(){void 0!==c&&c.exit(),v.exit()}}})}),t.onRemove=_=function(o,t){var i;return void 0===t?(t=o,(i=e.ROOM({roomServerName:p,name:b+"/remove"})).on("remove",t)):EACH(o,function(n,r){return void 0!==n?((i=e.ROOM({roomServerName:p,name:b+"/"+r+"/"+n+"/remove"})).on("remove",function(e){EACH(o,function(o,t){if(void 0!==o)if(o===TO_DELETE){if(void 0!==e[t])return!1}else if(e[t]!==o)return!1})===!0&&t(e)}),!1):void 0}),OBJECT({init:function(e,o){var t;o.exit=t=function(){void 0!==i&&i.exit()}}})}}}})})});