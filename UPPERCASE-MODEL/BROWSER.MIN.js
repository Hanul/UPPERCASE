FOR_BOX(n=>{n.MODEL=CLASS({init:(t,i,o)=>{i.getBoxName=(()=>{return n.boxName})}})});FOR_BOX(e=>{OVERRIDE(e.MODEL,o=>{e.MODEL=CLASS(t=>{let i={},n=0;t.getOnNewInfos=(()=>{return i});return{preset:()=>{return o},init:(o,t,r)=>{let d,c,a,u,s,E,v,f,m,l,A,O,C,N,M,R,T,g,S,D,h=r.roomServerName,x=r.name,P=r.initData,H=r.methodConfig,U=(r.isNotUsingObjectId,e.ROOM({roomServerName:h,name:x}));void 0!==H&&(d=H.create,c=H.get,a=H.update,u=H.remove,s=H.find,E=H.count,v=H.checkIsExists,void 0!==d&&(f=d.valid),void 0!==a&&(m=a.valid));t.getName=(()=>{return x}),t.getInitData=(()=>{return P}),t.getCreateValid=(()=>{return f}),t.getUpdateValid=(()=>{return m}),t.getRoom=(()=>{return U});d!==!1&&(l=t.create=((o,t)=>{let i,n,r,d,c;void 0!==t&&(CHECK_IS_DATA(t)!==!0?i=t:(i=t.success,n=t.notValid,r=t.notAuthed,d=t.error)),void 0!==P&&EACH(P,(e,t)=>{o[t]=e}),void 0!==f&&(c=f.checkAndWash(o)),void 0!==c&&c.checkHasError()===!0?void 0!==n?n(c.getErrors()):console.log("[UPPERCASE-MODEL] `"+e.boxName+"."+x+"Model.create` NOT VALID!: ",c.getErrors()):U.send({methodName:"create",data:o},o=>{let t,c,a,u;void 0!==o?(t=o.errorMsg,c=o.validErrors,a=o.isNotAuthed,u=o.savedData,void 0!==t?void 0!==d?d(t):console.log("[UPPERCASE-MODEL] `"+e.boxName+"."+x+"Model.create` ERROR: "+t):void 0!==c?void 0!==n?n(c):console.log("[UPPERCASE-MODEL] `"+e.boxName+"."+x+"Model.create` NOT VALID!: ",c):a===!0?void 0!==r?r():console.log("[UPPERCASE-MODEL] `"+e.boxName+"."+x+"Model.create` NOT AUTHED!"):void 0!==i&&i(u)):void 0!==i&&i()})})),c!==!1&&(A=t.get=((o,t)=>{let i,n,r,d;void 0===t&&(t=o,o={}),CHECK_IS_DATA(t)!==!0?i=t:(i=t.success,n=t.notExists,r=t.notAuthed,d=t.error),U.send({methodName:"get",data:o},t=>{let c,a,u;void 0!==t&&(c=t.errorMsg,a=t.isNotAuthed,u=t.savedData),void 0!==c?void 0!==d?d(c):console.log("[UPPERCASE-MODEL] `"+e.boxName+"."+x+"Model.get` ERROR: "+c):a===!0?void 0!==r?r():console.log("[UPPERCASE-MODEL] `"+e.boxName+"."+x+"Model.get` NOT AUTHED!"):void 0===u?void 0!==n?n():console.log("[UPPERCASE-MODEL] `"+e.boxName+"."+x+"Model.get` NOT EXISTS!",o):void 0!==i&&i(u)})}),O=t.getWatching=((o,i)=>{let n,r,d,c,a,u;return void 0===i&&(i=o,o={}),CHECK_IS_DATA(i)!==!0?n=i:(n=i.success,r=i.notExists,d=i.notAuthed,c=i.error),t.get(o,{success:o=>{let t;a!==!0&&void 0!==n&&(u=e.ROOM({roomServerName:h,name:x+"/"+o.id}),n(o,e=>{u.on("update",e)},e=>{u.on("remove",o=>{e(o),t()})},t=(()=>{void 0!==u&&(u.exit(),u=void 0)})))},notExists:r,notAuthed:d,error:c}),OBJECT({init:(e,o)=>{o.exit=(()=>{void 0!==u&&u.exit(),a=!0})}})})),a!==!1&&(C=t.update=((o,t)=>{let i,n,r,d,c,a,u,s,E,v,f=o.id,l=o.$inc,A=o.$push,O=o.$pull;void 0!==t&&(CHECK_IS_DATA(t)!==!0?i=t:(i=t.success,n=t.notValid,r=t.notExists,d=t.notAuthed,c=t.error)),void 0!==m&&(a=m.checkForUpdate(o),void 0!==l&&(u=m.checkForUpdate(l)),void 0!==A&&(s=m.checkForUpdate(RUN(()=>{let e={};return EACH(A,(o,t)=>{e[t]=[o]}),e}))),void 0!==O&&(E=m.checkForUpdate(RUN(()=>{let e={};return EACH(O,(o,t)=>{e[t]=[o]}),e})))),o.id=f,o.$inc=l,o.$push=A,o.$pull=O,void 0!==m&&(a.checkHasError()===!0||void 0!==u&&u.checkHasError()===!0||void 0!==s&&s.checkHasError()===!0||void 0!==E&&E.checkHasError()===!0)?(v=COMBINE([a.getErrors(),void 0===u?{}:u.getErrors(),void 0===s?{}:s.getErrors(),void 0===E?{}:E.getErrors()]),void 0!==n?n(v):console.log("[UPPERCASE-MODEL] `"+e.boxName+"."+x+"Model.update` NOT VALID!: ",v)):U.send({methodName:"update",data:o},t=>{let a,u,s,E,v;void 0!==t&&(a=t.errorMsg,u=t.validErrors,s=t.isNotAuthed,E=t.savedData,v=t.originData),void 0!==a?void 0!==c?c(a):console.log("[UPPERCASE-MODEL] `"+e.boxName+"."+x+"Model.update` ERROR: "+a):void 0!==u?void 0!==n?n(u):console.log("[UPPERCASE-MODEL] `"+e.boxName+"."+x+"Model.update` NOT VALID!: ",u):s===!0?void 0!==d?d():console.log("[UPPERCASE-MODEL] `"+e.boxName+"."+x+"Model.update` NOT AUTHED!"):void 0===E?void 0!==r?r():console.log("[UPPERCASE-MODEL] `"+e.boxName+"."+x+"Model.update` NOT EXISTS!",o):void 0!==i&&i(E,v)})})),u!==!1&&(N=t.remove=((o,t)=>{let i,n,r,d;void 0!==t&&(CHECK_IS_DATA(t)!==!0?i=t:(i=t.success,n=t.notExists,r=t.notAuthed,d=t.error)),U.send({methodName:"remove",data:o},t=>{let c,a,u;void 0!==t&&(c=t.errorMsg,a=t.isNotAuthed,u=t.originData),void 0!==c?void 0!==d?d(c):console.log("[UPPERCASE-MODEL] `"+e.boxName+"."+x+"Model.remove` ERROR: "+c):a===!0?void 0!==r?r():console.log("[UPPERCASE-MODEL] `"+e.boxName+"."+x+"Model.remove` NOT AUTHED!"):void 0===u?void 0!==n?n():console.log("[UPPERCASE-MODEL] `"+e.boxName+"."+x+"Model.remove` NOT EXISTS!",o):void 0!==i&&i(u)})})),s!==!1&&(M=t.find=((o,t)=>{let i,n,r;void 0===t&&(t=o,o=void 0),CHECK_IS_DATA(t)!==!0?i=t:(i=t.success,n=t.notAuthed,r=t.error),U.send({methodName:"find",data:o},o=>{let t=o.errorMsg,d=o.isNotAuthed,c=o.savedDataSet;void 0!==t?void 0!==r?r(t):console.log("[UPPERCASE-MODEL] `"+e.boxName+"."+x+"Model.find` ERROR: "+t):d===!0?void 0!==n?n():console.log("[UPPERCASE-MODEL] `"+e.boxName+"."+x+"Model.find` NOT AUTHED!"):void 0!==i&&i(c)})}),R=t.findWatching=((o,i)=>{let n,r,d,c,a={};return void 0===i&&(i=o,o=void 0),CHECK_IS_DATA(i)!==!0?n=i:(n=i.success,r=i.notAuthed,d=i.error),t.find(o,{success:o=>{let t;c!==!0&&void 0!==n&&(EACH(o,(o,t)=>{let i=o.id;a[i]=e.ROOM({roomServerName:h,name:x+"/"+i})}),n(o,(e,o)=>{a[e].on("update",o)},(e,o)=>{a[e].on("remove",i=>{o(i),t(e)})},t=(e=>{void 0!==a[e]&&(a[e].exit(),delete a[e])})))},notAuthed:r,error:d}),OBJECT({init:(e,o)=>{o.exit=(()=>{EACH(a,e=>{e.exit()}),c=!0})}})})),E!==!1&&(T=t.count=((o,t)=>{let i,n,r;void 0===t&&(t=o,o=void 0),CHECK_IS_DATA(t)!==!0?i=t:(i=t.success,n=t.notAuthed,r=t.error),U.send({methodName:"count",data:o},o=>{let t=o.errorMsg,d=o.isNotAuthed,c=o.count;void 0!==t?void 0!==r?r(t):console.log("[UPPERCASE-MODEL] `"+e.boxName+"."+x+"Model.count` ERROR: "+t):d===!0?void 0!==n?n():console.log("[UPPERCASE-MODEL] `"+e.boxName+"."+x+"Model.count` NOT AUTHED!"):void 0!==i&&i(c)})})),v!==!1&&(g=t.checkIsExists=((o,t)=>{let i,n,r;void 0===t&&(t=o,o=void 0),CHECK_IS_DATA(t)!==!0?i=t:(i=t.success,n=t.notAuthed,r=t.error),U.send({methodName:"checkIsExists",data:o},o=>{let t=o.errorMsg,d=o.isNotAuthed,c=o.isExists;void 0!==t?void 0!==r?r(t):console.log("[UPPERCASE-MODEL] `"+e.boxName+"."+x+"Model.checkIsExists` ERROR: "+t):d===!0?void 0!==n?n():console.log("[UPPERCASE-MODEL] `"+e.boxName+"."+x+"Model.checkIsExists` NOT AUTHED!"):void 0!==i&&i(c)})}));let I=t.onNew=((o,t)=>{let r,d=n;if(n+=1,void 0===t)t=o,o=void 0,(r=e.ROOM({roomServerName:h,name:x+"/create"})).on("create",e=>{i[d].lastCreateTime=e.createTime,t(e)});else if(void 0===o)(r=e.ROOM({roomServerName:h,name:x+"/create"})).on("create",e=>{i[d].lastCreateTime=e.createTime,t(e)});else if(EACH(o,(n,c)=>{if(void 0!==n)return(r=e.ROOM({roomServerName:h,name:x+"/"+c+"/"+n+"/create"})).on("create",e=>{EACH(o,(o,t)=>{if(void 0!==o)if(o===TO_DELETE){if(void 0!==e[t])return!1}else if(e[t]!==o)return!1})===!0&&(i[d].lastCreateTime=e.createTime,t(e))}),!1}),void 0===r)return void I(void 0,t);return i[d]={findMissingDataSet:()=>{void 0!==i[d].lastCreateTime&&void 0!==M&&M({filter:void 0!==o?COMBINE([o,{createTime:{$gt:i[d].lastCreateTime}}]):{createTime:{$gt:i[d].lastCreateTime}}},REVERSE_EACH(t))}},OBJECT({init:(e,o)=>{o.exit=(()=>{delete i[d],void 0!==r&&r.exit()})}})}),L=t.onNewWatching=((o,t)=>{let r,d=n,c=[],a=o=>{let i,n,r=o.id;c.push(i=e.ROOM({roomServerName:h,name:x+"/"+r})),t(o,e=>{i.on("update",e)},e=>{i.on("remove",o=>{e(o),n()})},n=(()=>{i.exit(),REMOVE({array:c,value:i})}))};if(n+=1,void 0===t)t=o,o=void 0,(r=e.ROOM({roomServerName:h,name:x+"/create"})).on("create",e=>{i[d].lastCreateTime=e.createTime,a(e)});else if(void 0===o)(r=e.ROOM({roomServerName:h,name:x+"/create"})).on("create",e=>{i[d].lastCreateTime=e.createTime,a(e)});else if(EACH(o,(t,n)=>{if(void 0!==t)return(r=e.ROOM({roomServerName:h,name:x+"/"+n+"/"+t+"/create"})).on("create",e=>{EACH(o,(o,t)=>{if(void 0!==o)if(o===TO_DELETE){if(void 0!==e[t])return!1}else if(e[t]!==o)return!1})===!0&&(i[d].lastCreateTime=e.createTime,a(e))}),!1}),void 0===r)return void L(void 0,t);return i[d]={findMissingDataSet:()=>{void 0!==i[d].lastCreateTime&&void 0!==M&&M({filter:void 0!==o?COMBINE([o,{createTime:{$gt:i[d].lastCreateTime}}]):{createTime:{$gt:i[d].lastCreateTime}}},REVERSE_EACH(a))}},OBJECT({init:(e,o)=>{o.exit=(()=>{delete i[d],void 0!==r&&r.exit(),EACH(c,e=>{e.exit()})})}})});s!==!1&&(S=t.onNewAndFind=((e,o)=>{let t,i,n,r,d,c,a,u,s,E,v;return void 0===o&&(o=e,e=void 0),void 0!==e&&(t=e.properties,i=e.filter,n=e.sort,r=e.start,d=e.count,c=e.isNotOnNew),CHECK_IS_DATA(o)!==!0?u=o:(u=o.handler,s=o.success,E=o.notAuthed,v=o.error),c!==!0&&(a=I(t,e=>{u(e,!0)})),M({filter:COMBINE([t,i]),sort:n,start:r,count:d},{success:e=>{void 0!==s&&s(e),REVERSE_EACH(e,e=>{u(e,!1)})},notAuthed:E,error:v}),OBJECT({init:(e,o)=>{o.exit=(()=>{void 0!==a&&a.exit()})}})}),D=t.onNewAndFindWatching=((e,o)=>{let t,i,n,r,d,c,a,u,s,E,v,f;return void 0===o&&(o=e,e=void 0),void 0!==e&&(t=e.properties,i=e.filter,n=e.sort,r=e.start,d=e.count,c=e.isNotOnNew),CHECK_IS_DATA(o)!==!0?a=o:(a=o.handler,u=o.success,s=o.notAuthed,E=o.error),c!==!0&&(v=L(t,(e,o,t,i)=>{a(e,o,t,i,!0)})),f=R({filter:COMBINE([t,i]),sort:n,start:r,count:d},{success:(e,o,t,i)=>{void 0!==u&&u(e,o,t,i),REVERSE_EACH(e,e=>{a(e,t=>{o(e.id,t)},o=>{t(e.id,o)},()=>{i(e.id)},!1)})},notAuthed:s,error:E}),OBJECT({init:(e,o)=>{o.exit=(()=>{void 0!==v&&v.exit(),f.exit()})}})}));t.onRemove=((o,t)=>{let i;return void 0===t?(t=o,(i=e.ROOM({roomServerName:h,name:x+"/remove"})).on("remove",t)):EACH(o,(n,r)=>{if(void 0!==n)return(i=e.ROOM({roomServerName:h,name:x+"/"+r+"/"+n+"/remove"})).on("remove",e=>{EACH(o,(o,t)=>{if(void 0!==o)if(o===TO_DELETE){if(void 0!==e[t])return!1}else if(e[t]!==o)return!1})===!0&&t(e)}),!1}),OBJECT({init:(e,o)=>{o.exit=(()=>{void 0!==i&&i.exit()})}})})}}})})});